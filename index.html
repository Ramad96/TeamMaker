<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2v2 Court Rotator v1.0.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .winner-glow { border-color: #22c55e !important; background-color: #064e3b !important; transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-slate-900 min-h-screen text-slate-100 pb-12">
    <div id="app" class="max-w-md mx-auto px-4 pt-8">
        
        <div id="setupScreen" class="space-y-6">
            <div class="text-center">
                <h1 class="text-3xl font-black text-white italic tracking-tighter uppercase">COURT ROTATOR <span class="text-xs align-top text-indigo-500 ml-1">v1.0.1</span></h1>
                <p class="text-slate-400 text-sm">Maximized 2v2 â€¢ Winner Stays</p>
            </div>
            <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl">
                <textarea id="playerInput" rows="6" class="w-full p-4 bg-slate-900 border border-slate-700 rounded-2xl focus:ring-2 focus:ring-indigo-500 outline-none text-white" placeholder="Enter player names..."></textarea>
                <button onclick="startTournament()" class="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl transition-all shadow-lg active:scale-95">
                    Open Courts
                </button>
            </div>
        </div>

        <div id="matchScreen" class="hidden space-y-6">
            <div class="text-center">
                <h2 class="text-xl font-black text-white italic tracking-tighter inline-block">COURT ROTATOR</h2>
                <span class="text-[10px] font-bold text-indigo-500 ml-1 uppercase">v1.0.1</span>
            </div>

            <div id="courtsContainer" class="space-y-8"></div>

            <div class="space-y-4 pt-6 border-t border-slate-800">
                <div id="waitingTeamsSection" class="hidden">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 px-2 text-center">Next Challenger Team(s)</h3>
                    <div id="waitingTeamsList" class="space-y-2"></div>
                </div>

                <div id="soloSection" class="hidden">
                    <h3 class="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2 px-2">Solo Player (Bench)</h3>
                    <div class="bg-amber-500/10 border border-amber-500/30 p-4 rounded-2xl flex items-center justify-between">
                        <span id="soloName" class="font-bold text-amber-500 text-lg"></span>
                        <button onclick="manualSwap()" class="flex items-center gap-1 bg-amber-500 text-black px-3 py-1 rounded-lg text-xs font-black active:scale-90 transition-transform">
                            <i data-lucide="refresh-cw" size="14"></i> SWAP IN
                        </button>
                    </div>
                </div>
            </div>

            <button onclick="location.reload()" class="w-full py-8 text-slate-600 text-[10px] font-bold uppercase tracking-[0.2em]">Reset All</button>
        </div>
    </div>

    <script>
        let courts = []; 
        let waitingQueue = []; 

        function startTournament() {
            const input = document.getElementById('playerInput').value;
            let players = input.split('\n').map(n => n.trim()).filter(n => n !== "");
            
            if (players.length < 4) {
                alert("Please enter at least 4 players.");
                return;
            }

            players.sort(() => Math.random() - 0.5);
            
            const numCourts = Math.floor(players.length / 4);
            courts = [];
            
            for (let i = 0; i < numCourts; i++) {
                const s = i * 4;
                courts.push({
                    teamA: [players[s], players[s+1]],
                    teamB: [players[s+2], players[s+3]]
                });
            }

            waitingQueue = players.slice(numCourts * 4);
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('matchScreen').classList.remove('hidden');
            render();
        }

        function handleWin(courtIdx, winnerKey) {
            const loserKey = winnerKey === 'teamA' ? 'teamB' : 'teamA';
            const losers = courts[courtIdx][loserKey];

            if (waitingQueue.length >= 2) {
                waitingQueue.push(...losers);
                courts[courtIdx][loserKey] = [waitingQueue.shift(), waitingQueue.shift()];
            } else {
                let shuffled = [...courts[courtIdx].teamA, ...courts[courtIdx].teamB].sort(() => Math.random() - 0.5);
                courts[courtIdx].teamA = [shuffled[0], shuffled[1]];
                courts[courtIdx].teamB = [shuffled[2], shuffled[3]];
            }

            render();
        }

        function manualSwap() {
            if (waitingQueue.length === 0) return;
            let solo = waitingQueue.shift();
            let lastCourtIdx = courts.length - 1;
            let active = courts[lastCourtIdx].teamB.pop();
            
            courts[lastCourtIdx].teamB.push(solo);
            waitingQueue.unshift(active);
            render();
        }

        function render() {
            const container = document.getElementById('courtsContainer');
            container.innerHTML = '';

            courts.forEach((court, idx) => {
                const courtDiv = document.createElement('div');
                courtDiv.className = "space-y-4";
                courtDiv.innerHTML = `
                    <div class="text-center text-[10px] font-bold text-slate-600 uppercase tracking-widest">Court ${idx + 1}</div>
                    <button onclick="handleWin(${idx}, 'teamA')" class="w-full bg-slate-800 p-6 rounded-3xl border-2 border-slate-700 transition-all text-center active:bg-slate-700">
                        <span class="text-[10px] font-bold text-indigo-400 uppercase">Team A</span>
                        <div class="text-xl font-bold mt-1 text-white">${court.teamA.join(' & ')}</div>
                    </button>
                    <div class="flex items-center gap-4 py-1 justify-center">
                        <div class="h-[1px] bg-slate-700 w-12"></div>
                        <div class="text-slate-500 font-black italic text-xs uppercase">vs</div>
                        <div class="h-[1px] bg-slate-700 w-12"></div>
                    </div>
                    <button onclick="handleWin(${idx}, 'teamB')" class="w-full bg-slate-800 p-6 rounded-3xl border-2 border-slate-700 transition-all text-center active:bg-slate-700">
                        <span class="text-[10px] font-bold text-rose-400 uppercase">Team B</span>
                        <div class="text-xl font-bold mt-1 text-white">${court.teamB.join(' & ')}</div>
                    </button>
                `;
                container.appendChild(courtDiv);
            });

            const waitingTeamsList = document.getElementById('waitingTeamsList');
            const soloName = document.getElementById('soloName');
            const soloSection = document.getElementById('soloSection');
            const waitingTeamsSection = document.getElementById('waitingTeamsSection');

            waitingTeamsList.innerHTML = '';
            let tempQueue = [...waitingQueue];
            let fullTeams = [];
            while (tempQueue.length >= 2) { fullTeams.push([tempQueue.shift(), tempQueue.shift()]); }

            if (fullTeams.length > 0) {
                waitingTeamsSection.classList.remove('hidden');
                fullTeams.forEach(team => {
                    const div = document.createElement('div');
                    div.className = "bg-slate-800 border border-slate-700 p-3 rounded-xl text-slate-300 font-medium text-center";
                    div.innerText = team.join(' & ');
                    waitingTeamsList.appendChild(div);
                });
            } else { waitingTeamsSection.classList.add('hidden'); }

            if (tempQueue.length === 1) {
                soloSection.classList.remove('hidden');
                soloName.innerText = tempQueue[0];
            } else { soloSection.classList.add('hidden'); }

            lucide.createIcons();
        }
    </script>
</body>
</html>